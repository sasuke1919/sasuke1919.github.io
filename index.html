<!DOCTYPE html>
<html>
    <script src="https://aframe.io/releases/1.0.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <body style="margin: 0px; overflow: hidden;">
        <a-scene embedded arjs="debugUIEnabled:false;" vr-mode-ui="enabled: false">
            <a-assets>
                <video id="ar-video" autoplay loop="true" preload="auto" src="test.mp4"></video>
                <audio src="videopath" autoplay></audio>
            </a-assets>
            <a-marker type="pattern" url="pattern_ice_station_z.patt">
                <a-video src="#ar-video" width="4.6" height="4.6" position="0 0 0" rotation="270 0 0" play="true"></a-video>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
        <script>
            // ビデオ格納用の変数定義を追加
            let video = null;
            AFRAME.registerComponent('registerevents', {
                init: function () {
                    let marker = this.el;
                    // マーカーを検出したイベントの登録
                    marker.addEventListener('markerFound', function () {
                        // マーカー認識したら、ビデオ再生
                        if (video == null) {
                            video = document.querySelector('#ar-video');
                        }
                        video.play();
                    });
                    // マーカーを見失ったイベントの登録
                    marker.addEventListener('markerLost', function () {
                        // マーカー認識が外れたら、、ビデオ停止
                        video.pause();
                    });
                }
            });
            /* ビデオクリックで再生するイベントは、一旦コメントアウトしました
            window.addEventListener('click', function () {
                video = document.querySelector('#ar-video');
                video.play();
            });
            */
        </script>    
    </body>
</html>
